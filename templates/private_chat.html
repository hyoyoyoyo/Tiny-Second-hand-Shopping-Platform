{% extends "base.html" %}
{% block title %}{{ target.username }}ë‹˜ê³¼ ì±„íŒ…{% endblock %}
{% block content %}
<h2>{{ target.username }}ë‹˜ê³¼ì˜ 1:1 ì±„íŒ…</h2>

<div id="chat" style="max-width: 500px; margin: auto;">
  <ul id="messages" style="height: 250px; border: 1px solid #ddd; overflow-y: scroll; padding: 10px; background-color: #f7f7f7; border-radius: 10px;"></ul>

  <input id="chat_input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
         style="width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc;">

  <!-- ì „ì†¡ ë²„íŠ¼ -->
  <button onclick="sendMessage()"
          style="width: 100%; padding: 12px; margin-top: 10px; background-color: #007bff; color: white; font-weight: bold; border: none; border-radius: 6px;">
    ì „ì†¡
  </button>

  <!-- ì†¡ê¸ˆí•˜ê¸° ë²„íŠ¼ (ìƒëŒ€ë°© ID í¬í•¨ëœ ë¼ìš°íŒ…) -->
  <button onclick="location.href='{{ url_for('payment', receiver_id=target.id) }}'"
          style="width: 100%; padding: 12px; margin-top: 10px; background-color: #28a745; color: white; font-weight: bold; border: none; border-radius: 6px;">
    ğŸ’¸ ì†¡ê¸ˆí•˜ê¸°
  </button>
</div>

<!-- ì†Œì¼“ ì—°ê²° ë° ë©”ì‹œì§€ ì²˜ë¦¬ -->
<script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
<script type="text/javascript">
  const socket = io();
  const room = "{{ user['id'] }}_{{ target['id'] }}";

  socket.emit('join_room', { room: room });

  socket.on('connect', function () {
    console.log("âœ… ì—°ê²°ë¨");
  });

  socket.on('message', function (data) {
    const item = document.createElement('li');
    item.textContent = `${data.sender}: ${data.message}`;
    document.getElementById('messages').appendChild(item);
  });

  function sendMessage() {
    const input = document.getElementById('chat_input');
    const message = input.value;
    if (message.trim()) {
      socket.emit('send_private_message', {
        room: room,
        sender: "{{ user['username'] }}",
        message: message
      });
      input.value = '';
    }
  }
</script>
{% endblock %}
